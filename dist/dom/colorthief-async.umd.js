!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.ColorThief={})}(this,function(t){if(!r)var r={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,e){return n.index=e,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(t,n){return Math.max.apply(null,n?r.map(t,n):t)}};var n=function(){var t=5,n=8-t,o=1e3;function e(r,n,o){return(r<<2*t)+(n<<t)+o}function i(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function u(t,r,n,o,e,i,u){this.r1=t,this.r2=r,this.g1=n,this.g2=o,this.b1=e,this.b2=i,this.histo=u}function a(){this.vboxes=new i(function(t,n){return r.naturalOrder(t.vbox.count()*t.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function s(t,n){if(n.count()){var o=n.r2-n.r1+1,i=n.g2-n.g1+1,u=r.max([o,i,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var a,s,c,f,h=0,l=[],v=[];if(u==o)for(a=n.r1;a<=n.r2;a++){for(f=0,s=n.g1;s<=n.g2;s++)for(c=n.b1;c<=n.b2;c++)f+=t[e(a,s,c)]||0;l[a]=h+=f}else if(u==i)for(a=n.g1;a<=n.g2;a++){for(f=0,s=n.r1;s<=n.r2;s++)for(c=n.b1;c<=n.b2;c++)f+=t[e(s,a,c)]||0;l[a]=h+=f}else for(a=n.b1;a<=n.b2;a++){for(f=0,s=n.r1;s<=n.r2;s++)for(c=n.g1;c<=n.g2;c++)f+=t[e(s,c,a)]||0;l[a]=h+=f}return l.forEach(function(t,r){v[r]=h-t}),function(t){var r,o,e,i,u,s=t+"1",c=t+"2",f=0;for(a=n[s];a<=n[c];a++)if(l[a]>h/2){for(e=n.copy(),i=n.copy(),u=(r=a-n[s])<=(o=n[c]-a)?Math.min(n[c]-1,~~(a+o/2)):Math.max(n[s],~~(a-1-r/2));!l[u];)u++;for(f=v[u];!f&&l[u-1];)f=v[--u];return e[c]=u,i[s]=e[c]+1,[e,i]}}(u==o?"r":u==i?"g":"b")}}return u.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var r=this.histo;if(!this._count_set||t){var n,o,i,u=0;for(n=this.r1;n<=this.r2;n++)for(o=this.g1;o<=this.g2;o++)for(i=this.b1;i<=this.b2;i++)u+=r[e(n,o,i)]||0;this._count=u,this._count_set=!0}return this._count},copy:function(){return new u(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var n=this.histo;if(!this._avg||r){var o,i,u,a,s=0,c=1<<8-t,f=0,h=0,l=0;for(i=this.r1;i<=this.r2;i++)for(u=this.g1;u<=this.g2;u++)for(a=this.b1;a<=this.b2;a++)s+=o=n[e(i,u,a)]||0,f+=o*(i+.5)*c,h+=o*(u+.5)*c,l+=o*(a+.5)*c;this._avg=s?[~~(f/s),~~(h/s),~~(l/s)]:[~~(c*(this.r1+this.r2+1)/2),~~(c*(this.g1+this.g2+1)/2),~~(c*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var r=t[0]>>n;return gval=t[1]>>n,bval=t[2]>>n,r>=this.r1&&r<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},a.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,e=this.vboxes,i=0;i<e.size();i++)((n=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<r||void 0===r)&&(r=n,o=e.peek(i).color);return o},forcebw:function(){var t=this.vboxes;t.sort(function(t,n){return r.naturalOrder(r.sum(t.color),r.sum(n.color))});var n=t[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(t[0].color=[0,0,0]);var o=t.length-1,e=t[o].color;e[0]>251&&e[1]>251&&e[2]>251&&(t[o].color=[255,255,255])}},{quantize:function(c,f){if(!c.length||f<2||f>256)return!1;var h=function(r){var o,i=new Array(1<<3*t);return r.forEach(function(t){o=e(t[0]>>n,t[1]>>n,t[2]>>n),i[o]=(i[o]||0)+1}),i}(c);h.forEach(function(){});var l=function(t,r){var o,e,i,a=1e6,s=0,c=1e6,f=0,h=1e6,l=0;return t.forEach(function(t){(o=t[0]>>n)<a?a=o:o>s&&(s=o),(e=t[1]>>n)<c?c=e:e>f&&(f=e),(i=t[2]>>n)<h?h=i:i>l&&(l=i)}),new u(a,s,c,f,h,l,r)}(c,h),v=new i(function(t,n){return r.naturalOrder(t.count(),n.count())});function p(t,r){for(var n,e=t.size(),i=0;i<o;){if(e>=r)return;if(i++>o)return;if((n=t.pop()).count()){var u=s(h,n),a=u[0],c=u[1];if(!a)return;t.push(a),c&&(t.push(c),e++)}else t.push(n),i++}}v.push(l),p(v,.75*f);for(var g=new i(function(t,n){return r.naturalOrder(t.count()*t.volume(),n.count()*n.volume())});v.size();)g.push(v.pop());p(g,f);for(var b=new a;g.size();)b.push(g.pop());return b}}}().quantize,o=function(t,r){return i(t).then(function(t){var o=function(t,r,n){var o=function(t){var r=t||{},n=r.colorCount,o=r.quality;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return void 0===o||Number.isInteger(o)?o=10:o<1&&(o=10),{colorCount:n,quality:o}}(n),e=o.colorCount,i=r(function(r,n,o){for(var e=t.data,i=[],u=0,a=void 0,s=void 0,c=void 0,f=void 0,h=void 0;u<n;u+=o)s=e[0+(a=4*u)],c=e[a+1],f=e[a+2],(void 0===(h=e[a+3])||h>=125)&&(s>250&&c>250&&f>250||i.push([s,c,f]));return i}(0,t.width*t.height,o.quality),e);return i?i.palette():null}(e(t),n,r);if(!o)throw new Error("Failed to get image color palette");return o})},e=function(t){var r=document.createElement("canvas"),n=r.getContext("2d");if(null==n)throw new Error("Failed to get canvas context");var o=r.width=u(t.width),e=r.height=u(t.height);return n.drawImage(t,0,0,o,e),n.getImageData(0,0,o,e)},i=function(t){return new Promise(function(r,n){if("string"==typeof t){var o=setTimeout(function(){n("Timed out waiting for image to load")},1e4),e=document.createElement("img");e.addEventListener("load",function(){clearTimeout(o),r(e)}),e.src=t}else r(t)})},u=function(t){return"number"!=typeof t?t.baseVal.value:t};t.getColor=function(t,r,n){return o(t,{quality:r,colorCount:5}).then(function(t){return n&&n(t[0]),t[0]})},t.getPalette=function(t,r,n){return o(t,r).then(function(t){return n&&n(t),t})}});
//# sourceMappingURL=colorthief-async.umd.js.map
